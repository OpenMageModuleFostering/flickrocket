<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * @see Mage_Downloadable_Block_Customer_Products_List
 */
?>

<?php

	function endsWith($haystack, $needle, $case = true) {
		if ($case) {
			return (strcmp(substr($haystack, strlen($haystack) - strlen($needle)), $needle) === 0);
		}
		return (strcasecmp(substr($haystack, strlen($haystack) - strlen($needle)), $needle) === 0);
	}

	$Customer = Mage::getModel('customer/customer')->load(Mage::getSingleton('customer/session')->getId());
	
	$targetURL = Mage::helper('flux')->prepareLoginEx( $Customer->getEmail(), $Customer->getPasswordHash()) . "&externaltype=1&theme=" . Mage::getStoreConfig('acegmbh_flux/flux/flux_theme_id');
	$targetScheme = parse_url($targetURL, PHP_URL_SCHEME);
	if (is_null($targetScheme))
	{
		$scheme = "http";
		$host = parse_url($scheme . "://" . $targetURL, PHP_URL_HOST);
		if (endsWith($host, ".flickrocket.com", false))
			$scheme .= "s";
		
		$targetURL = $scheme . "://" . $targetURL;
	}
	
	echo "<iframe src=\"" . $targetURL . "\" frameBorder=\"0\" width=\"100%\" height=\"1600px\"></iframe>";

?>
